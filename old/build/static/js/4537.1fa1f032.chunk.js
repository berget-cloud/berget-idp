"use strict";(self.webpackChunkberget_idp=self.webpackChunkberget_idp||[]).push([[4537],{4537:function(e,t,n){n.r(t),n.d(t,{default:function(){return c}});var i=n(579),s=n(5043),r=n(2591),a=n(3233),l=n(569);function c(e){const{kcContext:t,i18n:n,doUseDefaultCss:c,Template:u,classes:d}=e,{kcClsx:p}=(0,a.z)({doUseDefaultCss:c,classes:d}),{url:m,challenge:h,userid:b,username:y,signatureAlgorithms:g,rpEntityName:f,rpId:C,attestationConveyancePreference:x,authenticatorAttachment:j,requireResidentKey:S,userVerificationRequirement:k,createTimeout:A,excludeCredentialIds:K,isSetRetry:v,isAppInitiatedAction:O}=t,{msg:$,msgStr:w}=n,{insertScriptTags:N}=(0,l.p)({componentOrHookName:"WebauthnRegister",scriptTags:[{type:"text/javascript",src:`${m.resourcesCommonPath}/node_modules/jquery/dist/jquery.min.js`},{type:"text/javascript",src:`${m.resourcesPath}/js/base64url.js`},{type:"text/javascript",textContent:`\n                function registerSecurityKey() {\n\n                    // Check if WebAuthn is supported by this browser\n                    if (!window.PublicKeyCredential) {\n                        $("#error").val("${w("webauthn-unsupported-browser-text")}");\n                        $("#register").submit();\n                        return;\n                    }\n    \n                    // mandatory parameters\n                    let challenge = "${h}";\n                    let userid = "${b}";\n                    let username = "${y}";\n    \n                    let signatureAlgorithms =${JSON.stringify(g)};\n                    let pubKeyCredParams = getPubKeyCredParams(signatureAlgorithms);\n    \n                    let rpEntityName = "${f}";\n                    let rp = {name: rpEntityName};\n    \n                    let publicKey = {\n                        challenge: base64url.decode(challenge, {loose: true}),\n                        rp: rp,\n                        user: {\n                            id: base64url.decode(userid, {loose: true}),\n                            name: username,\n                            displayName: username\n                        },\n                        pubKeyCredParams: pubKeyCredParams,\n                    };\n    \n                    // optional parameters\n                    let rpId = "${C}";\n                    publicKey.rp.id = rpId;\n    \n                    let attestationConveyancePreference = "${x}";\n                    if (attestationConveyancePreference !== 'not specified') publicKey.attestation = attestationConveyancePreference;\n    \n                    let authenticatorSelection = {};\n                    let isAuthenticatorSelectionSpecified = false;\n    \n                    let authenticatorAttachment = "${j}";\n                    if (authenticatorAttachment !== 'not specified') {\n                        authenticatorSelection.authenticatorAttachment = authenticatorAttachment;\n                        isAuthenticatorSelectionSpecified = true;\n                    }\n    \n                    let requireResidentKey = "${S}";\n                    if (requireResidentKey !== 'not specified') {\n                        if (requireResidentKey === 'Yes')\n                            authenticatorSelection.requireResidentKey = true;\n                        else\n                            authenticatorSelection.requireResidentKey = false;\n                        isAuthenticatorSelectionSpecified = true;\n                    }\n    \n                    let userVerificationRequirement = "${k}";\n                    if (userVerificationRequirement !== 'not specified') {\n                        authenticatorSelection.userVerification = userVerificationRequirement;\n                        isAuthenticatorSelectionSpecified = true;\n                    }\n    \n                    if (isAuthenticatorSelectionSpecified) publicKey.authenticatorSelection = authenticatorSelection;\n    \n                    let createTimeout = ${A};\n                    if (createTimeout !== 0) publicKey.timeout = createTimeout * 1000;\n    \n                    let excludeCredentialIds = "${K}";\n                    let excludeCredentials = getExcludeCredentials(excludeCredentialIds);\n                    if (excludeCredentials.length > 0) publicKey.excludeCredentials = excludeCredentials;\n    \n                    navigator.credentials.create({publicKey})\n                        .then(function (result) {\n                            window.result = result;\n                            let clientDataJSON = result.response.clientDataJSON;\n                            let attestationObject = result.response.attestationObject;\n                            let publicKeyCredentialId = result.rawId;\n    \n                            $("#clientDataJSON").val(base64url.encode(new Uint8Array(clientDataJSON), {pad: false}));\n                            $("#attestationObject").val(base64url.encode(new Uint8Array(attestationObject), {pad: false}));\n                            $("#publicKeyCredentialId").val(base64url.encode(new Uint8Array(publicKeyCredentialId), {pad: false}));\n    \n                            if (typeof result.response.getTransports === "function") {\n                                let transports = result.response.getTransports();\n                                if (transports) {\n                                    $("#transports").val(getTransportsAsString(transports));\n                                }\n                            } else {\n                                console.log("Your browser is not able to recognize supported transport media for the authenticator.");\n                            }\n    \n                            let initLabel = "WebAuthn Authenticator (Default Label)";\n                            let labelResult = window.prompt("Please input your registered authenticator's label", initLabel);\n                            if (labelResult === null) labelResult = initLabel;\n                            $("#authenticatorLabel").val(labelResult);\n    \n                            $("#register").submit();\n    \n                        })\n                        .catch(function (err) {\n                            $("#error").val(err);\n                            $("#register").submit();\n    \n                        });\n                }\n    \n                function getPubKeyCredParams(signatureAlgorithmsList) {\n                    let pubKeyCredParams = [];\n                    if (signatureAlgorithmsList.length === 0) {\n                        pubKeyCredParams.push({type: "public-key", alg: -7});\n                        return pubKeyCredParams;\n                    }\n    \n                    for (let i = 0; i < signatureAlgorithmsList.length; i++) {\n                        pubKeyCredParams.push({\n                            type: "public-key",\n                            alg: signatureAlgorithmsList[i]\n                        });\n                    }\n                    return pubKeyCredParams;\n                }\n    \n                function getExcludeCredentials(excludeCredentialIds) {\n                    let excludeCredentials = [];\n                    if (excludeCredentialIds === "") return excludeCredentials;\n    \n                    let excludeCredentialIdsList = excludeCredentialIds.split(',');\n    \n                    for (let i = 0; i < excludeCredentialIdsList.length; i++) {\n                        excludeCredentials.push({\n                            type: "public-key",\n                            id: base64url.decode(excludeCredentialIdsList[i],\n                            {loose: true})\n                        });\n                    }\n                    return excludeCredentials;\n                }\n    \n                function getTransportsAsString(transportsList) {\n                    if (transportsList === '' || Array.isArray(transportsList)) return "";\n    \n                    let transportsString = "";\n    \n                    for (let i = 0; i < transportsList.length; i++) {\n                        transportsString += transportsList[i] + ",";\n                    }\n    \n                    return transportsString.slice(0, -1);\n                }\n                `}]});return(0,s.useEffect)((()=>{N()}),[]),(0,i.jsxs)(u,Object.assign({kcContext:t,i18n:n,doUseDefaultCss:c,classes:d,headerNode:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:p("kcWebAuthnKeyIcon")}),$("webauthn-registration-title")]})},{children:[(0,i.jsx)("form",Object.assign({id:"register",className:p("kcFormClass"),action:m.loginAction,method:"post"},{children:(0,i.jsxs)("div",Object.assign({className:p("kcFormGroupClass")},{children:[(0,i.jsx)("input",{type:"hidden",id:"clientDataJSON",name:"clientDataJSON"}),(0,i.jsx)("input",{type:"hidden",id:"attestationObject",name:"attestationObject"}),(0,i.jsx)("input",{type:"hidden",id:"publicKeyCredentialId",name:"publicKeyCredentialId"}),(0,i.jsx)("input",{type:"hidden",id:"authenticatorLabel",name:"authenticatorLabel"}),(0,i.jsx)("input",{type:"hidden",id:"transports",name:"transports"}),(0,i.jsx)("input",{type:"hidden",id:"error",name:"error"}),(0,i.jsx)(o,{kcClsx:p,i18n:n})]}))})),(0,i.jsx)("input",{type:"submit",className:p("kcButtonClass","kcButtonPrimaryClass","kcButtonBlockClass","kcButtonLargeClass"),id:"registerWebAuthn",value:w("doRegisterSecurityKey"),onClick:()=>{(0,r.v)("registerSecurityKey"in window),(0,r.v)("function"===typeof window.registerSecurityKey),window.registerSecurityKey()}}),!v&&O&&(0,i.jsx)("form",Object.assign({action:m.loginAction,className:p("kcFormClass"),id:"kc-webauthn-settings-form",method:"post"},{children:(0,i.jsx)("button",Object.assign({type:"submit",className:p("kcButtonClass","kcButtonDefaultClass","kcButtonBlockClass","kcButtonLargeClass"),id:"cancelWebAuthnAIA",name:"cancel-aia",value:"true"},{children:$("doCancel")}))}))]}))}function o(e){const{kcClsx:t,i18n:n}=e,{msg:s}=n;return(0,i.jsx)("div",Object.assign({id:"kc-form-options",className:t("kcFormOptionsClass")},{children:(0,i.jsx)("div",Object.assign({className:t("kcFormOptionsWrapperClass")},{children:(0,i.jsx)("div",Object.assign({className:"checkbox"},{children:(0,i.jsxs)("label",{children:[(0,i.jsx)("input",{type:"checkbox",id:"logout-sessions",name:"logout-sessions",value:"on",defaultChecked:!0}),s("logoutOtherSessions")]})}))}))}))}}}]);
//# sourceMappingURL=4537.1fa1f032.chunk.js.map